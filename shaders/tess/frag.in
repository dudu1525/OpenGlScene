    #version 410 core
    in vec2 TexCoordFrag;
    out vec4 FragColor;

    //for lightning
    in vec3 fNormalWorld;
    in vec3 fPosWorld;

    struct DirLight {
        vec3 direction;
        vec3 ambient;
        vec3 diffuse;
        vec3 specular;
    };
    struct PointLight {    
    vec3 position;
    
    float constant;
    float linear;
    float quadratic;  

    vec3 ambient;
    vec3 diffuse;
    vec3 specular;
};
    uniform DirLight dirLight;
    uniform PointLight pointlight;
    uniform vec3 viewPos;

    uniform sampler2D sandTexture;
    uniform sampler2D roughTexture;


    vec3 CalcDirLight(DirLight light, vec3 normal, vec3 viewDir);
    vec3 CalcPointLight(PointLight light, vec3 normal,vec3 fragPos, vec3 viewDir);

    void main() {

        vec3 normal = normalize(fNormalWorld);




        vec3 viewDir = normalize(viewPos - fPosWorld); //vector towards camera for phong model

        vec3 lightResult = CalcDirLight(dirLight, normal, viewDir);

        lightResult+= CalcPointLight(pointlight, normal, fPosWorld,viewDir);


        FragColor = vec4(lightResult, 1.0);



    }

    vec3 CalcDirLight(DirLight light, vec3 normal, vec3 viewDir) {
        vec3 lightDir = normalize(-light.direction);//inverse the direction, from terrain to 'sun'


        float diff = max(dot(normal, lightDir), 0.0);


        vec3 reflectDir = reflect(-lightDir, normal);

        float roughness = texture(roughTexture, TexCoordFrag).r; //take the roughness texture
        float shininess = mix(128.0, 2.0, roughness);  //interpolate between 128 and 2

        float spec = pow(max(dot(viewDir, reflectDir), 0.0), shininess);
        vec3 texColor = texture(sandTexture, TexCoordFrag).rgb;


        vec3 ambient  = light.ambient  * texColor;
        vec3 diffuse  = light.diffuse  * diff * texColor;

        vec3 specular = light.specular * spec *  roughness * 0.03;;  //to lower the specular circle

        return (ambient + diffuse + specular);
    }

    vec3 CalcPointLight(PointLight light, vec3 normal, vec3 fragPos, vec3 viewDir)
{
    vec3 lightDir = normalize(light.position - fragPos);
    // diffuse shading
    float diff = max(dot(normal, lightDir), 0.0);
    // specular shading
    vec3 reflectDir = reflect(-lightDir, normal);

    float roughness = texture(roughTexture, TexCoordFrag).r; //take the roughness texture
    float shininess = mix(128.0, 2.0, roughness);
    float spec = pow(max(dot(viewDir, reflectDir), 0.0),shininess);
    // attenuation
    float distance    = length(light.position - fragPos);
    float attenuation = 1.0 / (light.constant + light.linear * distance + 
  			     light.quadratic * (distance * distance));    

    vec3 texDiffuse = texture(sandTexture, TexCoordFrag).rgb;

    vec3 ambient  = light.ambient  * texDiffuse ;
    vec3 diffuse  = light.diffuse  * diff * texDiffuse;
    vec3 specular = light.specular * spec* 0.03;
    return (ambient + diffuse + specular)*attenuation;
} 